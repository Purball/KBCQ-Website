<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>KBCQ Admin – Reviews</title>
<style>
  body{font-family:Segoe UI,Tahoma,sans-serif;background:#faf4f2;margin:0;padding:2rem;color:#222;}
  h1{color:#b22222;text-align:center;}
  .box{max-width:600px;margin:1rem auto;background:#fff;padding:1.5rem;border-radius:10px;
       box-shadow:0 2px 6px rgba(0,0,0,.15);}
  input,select,textarea{width:100%;margin:.3rem 0;padding:.6rem;border:1px solid #ccc;border-radius:6px;}
  button{background:#b22222;color:#fff;border:none;padding:.6rem 1.2rem;border-radius:6px;cursor:pointer;}
  button:hover{background:#d63b3b;}
  #reviewList img{width:70px;height:70px;object-fit:cover;border-radius:6px;margin-right:4px;}
  .reviewItem{border-bottom:1px solid #ddd;padding:.5rem 0;}
</style>
</head>
<body>

<h1>Kim’s Blue Crab Quest – Admin</h1>

<div class="box" id="authBox">
  <h3>Sign In</h3>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button id="loginBtn">Sign In</button>
  <button id="logoutBtn" style="display:none;">Sign Out</button>
</div>

<div class="box" id="formBox" style="display:none;">
  <h3>Add a Review</h3>
  <input id="restaurant" placeholder="Restaurant Name">
  <select id="rating">
    <option value="">Rating</option>
    <option value="5">⭐⭐⭐⭐⭐</option>
    <option value="4">⭐⭐⭐⭐</option>
    <option value="3">⭐⭐⭐</option>
    <option value="2">⭐⭐</option>
    <option value="1">⭐</option>
  </select>
  <input id="location" placeholder="Location">
  <textarea id="comment" rows="3" placeholder="Comment"></textarea>
  <input id="hashtag" placeholder="#Hashtag">
  <textarea id="photoURLs" rows="2" placeholder="Paste Google Photos URLs, separated by commas"></textarea>
  <button id="submitBtn">Submit Review</button>
</div>

<div class="box" id="reviewList" style="display:none;">
  <h3>Existing Reviews</h3>
  <div id="reviewsContainer"></div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBfsNVnz82BM1KvQuksXywK8nLqgcdC4-o",
  authDomain: "kbcq-e3a4f.firebaseapp.com",
  projectId: "kbcq-e3a4f",
  storageBucket: "kbcq-e3a4f.firebasestorage.app",
  messagingSenderId: "763431750367",
  appId: "1:763431750367:web:f0df6a15426298b8fbf76a",
  measurementId: "G-83GG3HYTXP"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ---------- Auth logic ----------
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
loginBtn.onclick = ()=> {
  const email=document.getElementById('email').value;
  const pass=document.getElementById('password').value;
  auth.signInWithEmailAndPassword(email,pass).catch(e=>alert(e.message));
};
logoutBtn.onclick = ()=>auth.signOut();

auth.onAuthStateChanged(u=>{
  if(u){
    document.getElementById('authBox').style.display='none';
    document.getElementById('formBox').style.display='block';
    document.getElementById('reviewList').style.display='block';
    loadReviews();
  } else {
    document.getElementById('authBox').style.display='block';
    document.getElementById('formBox').style.display='none';
    document.getElementById('reviewList').style.display='none';
  }
});

// ---------- Add review ----------
document.getElementById('submitBtn').onclick = async ()=>{
  const rest=document.getElementById('restaurant').value.trim();
  const rating=parseInt(document.getElementById('rating').value);
  const loc=document.getElementById('location').value.trim();
  const com=document.getElementById('comment').value.trim();
  const hash=document.getElementById('hashtag').value.trim();
  const photoURLs=document.getElementById('photoURLs').value
                      .split(',')
                      .map(u=>u.trim())
                      .filter(u=>u.length>0);

  if(!rest||!rating||!com){alert("Restaurant, rating, and comment are required.");return;}

  await db.collection('reviews').add({
    restaurant:rest,
    rating,
    location:loc,
    comment:com,
    hashtag:hash,
    photoURLs,
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  alert("Review added!");
  document.getElementById('restaurant').value='';
  document.getElementById('rating').value='';
  document.getElementById('location').value='';
  document.getElementById('comment').value='';
  document.getElementById('hashtag').value='';
  document.getElementById('photoURLs').value='';
  loadReviews();
};

// ---------- Load reviews ----------
async function loadReviews(){
  const container=document.getElementById('reviewsContainer');
  container.innerHTML='';
  const snap=await db.collection('reviews').orderBy('createdAt','desc').limit(20).get();
  snap.forEach(doc=>{
    const r=doc.data();
    const div=document.createElement('div');
    div.className='reviewItem';
    div.innerHTML=`
      <strong>${r.restaurant}</strong> – ${'⭐'.repeat(r.rating)}<br>
      <em>${r.location||''}</em><br>
      ${r.comment}<br>
      ${r.hashtag?('#'+r.hashtag):''}<br>
      ${(r.photoURLs||[]).map(u=>`<img src="${u}" alt="photo">`).join('')}
    `;
    container.appendChild(div);
  });
}
</script>
</body>
</html>
